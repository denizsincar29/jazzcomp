# Структура Проекта "Jazz Composition Generator"

Этот документ описывает структуру каталогов и файлов проекта, а также назначение основных модулей и классов.

## Файловая структура

```
├── .gitignore          # Файл для исключения файлов из Git
├── .python-version     # Версия Python для проекта (если используется pyenv)
├── README.md           # Основной README файл проекта (предположительно на английском)
├── STRUCTURE.md        # Этот файл (описание структуры на русском)
├── app.py              # FastAPI приложение для генерации музыки через веб-интерфейс
├── bass.py             # Модуль для генерации басовой линии
├── bass_algorithm.md   # Документация по алгоритму генерации баса (предположительно)
├── course_work.md      # Возможно, описание курсовой работы (предположительно)
├── drum_sounds.py      # Модуль, генерирующий звуки ударных инструментов (семплы)
├── drums.py            # Модуль для генерации партии ударных
├── harmony.py          # Модуль с музыкально-теоретическими функциями (гармония, аккорды)
├── main.py             # Основной скрипт для запуска генерации музыки из командной строки
├── notes_with_octaves.py # Модуль для представления нот с указанием октавы
├── pyproject.toml      # Файл конфигурации проекта Python (PEP 518)
├── sound_combiner.py   # Модуль для сведения (микширования) аудиодорожек
├── test_notes_with_octaves.py # Тесты для notes_with_octaves.py (предположительно)
└── uv.lock             # Лок-файл зависимостей для UV (менеджер пакетов)
```

## Описание Модулей (Python Файлов)

### `app.py`
- **Назначение**: Реализует веб-приложение на FastAPI.
- **Основной функционал**:
    - Предоставляет HTML-форму для ввода последовательности аккордов.
    - Принимает POST-запрос с аккордами.
    - Оркестрирует процесс генерации баса и ударных, используя другие модули.
    - Конвертирует сгенерированные музыкальные партии (бас) в WAV-файлы (используя `music21` и MuseScore).
    - Сводит дорожки баса и ударных в один WAV-файл.
    - Возвращает сгенерированный WAV-файл пользователю для скачивания.
    - Управляет временными файлами, создаваемыми в процессе.

### `bass.py`
- **Назначение**: Генерация басовой линии на основе заданной последовательности аккордов.
- **Основные классы/функции**:
    - `ProgressionItem`: Представляет элемент в последовательности аккордов (аккорд с длительностью или событие).
    - `ChordProgression`: Класс для парсинга строки с аккордами и управления последовательностью.
        - `from_string(cls, string, ...)`: Создает экземпляр из строки.
        - `generate_bass_line()`: Генерирует басовую линию (список объектов `NoteWithOctave`).
        - `__iter__()`: Позволяет итерироваться по последовательности, раскрывая секции.

### `drums.py`
- **Назначение**: Генерация партии ударных инструментов.
- **Основные классы/функции**:
    - `DrumPattern`: Класс для создания паттернов ударных.
        - `__init__(self, tempo, num_quarters)`: Конструктор.
        - `add(self, file_path, measure, quarter, ...)`: Добавляет звук ударного в паттерн (использует `AudioCombiner`).
        - `create_pattern(self, bars)`: Генерирует предопределенный или алгоритмический паттерн ударных на заданное количество тактов.
        - `self.combiner`: Экземпляр `AudioCombiner` (`sound_combiner.AudioCombiner`), используемый для размещения звуков ударных.

### `drum_sounds.py`
- **Назначение**: Предположительно, содержит функции, которые генерируют или загружают короткие аудио семплы для различных звуков ударных (например, бочка, малый барабан, хай-хэт). Эти функции, вероятно, возвращают пути к временным WAV-файлам этих звуков.

### `harmony.py`
- **Назначение**: Содержит утилиты и функции, связанные с музыкальной гармонией и теорией.
- **Основные классы/функции**:
    - `chord_to_scale(p: Parser, c: Chord) -> list[Note]`: Преобразует объект аккорда в список нот, составляющих соответствующий лад/гамму.
    - `get_gravitating_notes(c: Chord) -> list[Note]`: Определяет ноты, которые создают тяготение к следующему аккорду (используется в `bass.py`).
    - `generate_bass_bar(...)`: Генерирует музыкальный материал для басовой линии на один такт (используется в `bass.py`).
    - Использует библиотеку `chordparser` для работы с аккордами.

### `main.py`
- **Назначение**: Консольный скрипт для запуска процесса генерации музыки.
- **Основной функционал**:
    - Определяет тестовую последовательность аккордов.
    - Использует `ChordProgression` для генерации баса.
    - Использует `DrumPattern` для генерации ударных.
    - Конвертирует сгенерированную партию баса в MusicXML и затем в WAV с помощью `music21` и MuseScore.
    - Использует `AudioCombiner` (через `DrumPattern`) для сведения дорожек баса и ударных в финальный WAV-файл.
    - Служит примером использования и точкой входа для пакетной генерации.

### `notes_with_octaves.py`
- **Назначение**: Определяет способ представления музыкальных нот с указанием их октавы.
- **Основные классы/функции**:
    - `NoteWithOctave`: Датакласс, представляющий ноту (`chordparser.Note`), ее октаву (`int`) и длительность (`length: int`).
        - `to_midi()`: Конвертирует ноту в MIDI-число.
        - `from_midi(cls, midi: int)`: Создает ноту из MIDI-числа.
        - `transpose(self, semitones: int)`: Транспонирует ноту.
        - `go_in_scale(self, scale: list[Note], steps: int)`: Перемещает ноту по ладу/гамме.

### `sound_combiner.py`
- **Назначение**: Предоставляет функционал для микширования (сведения) нескольких аудиофайлов или звуковых событий в один WAV-файл.
- **Основные классы/функции**:
    - `AudioCombiner`: Класс, отвечающий за сведение звуков.
        - `__init__(self, tempo, num_quarters_per_bar)`: Конструктор.
        - `place_at(self, wav_path_or_sound_data, measure, quarter, ...)`: Размещает звук (из WAV-файла или аудиоданных) в определенной временной позиции в миксе.
        - `export(self, output_filename, format="wav")`: Экспортирует сведенный результат в WAV-файл. Использует `pydub` для аудио манипуляций.

### `test_notes_with_octaves.py`
- **Назначение**: Содержит юнит-тесты для класса `NoteWithOctave` из модуля `notes_with_octaves.py`. Проверяет корректность конвертации в/из MIDI, транспонирования и других операций с нотами.

---

Эта структура обеспечивает модульность и позволяет расширять функционал генератора музыки.
```
